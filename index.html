<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>إدارة مخزون الصيدلية - v2.3</title>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <meta name="theme-color" content="#0f9b0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Bootstrap -->
    <link id="bsLang" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

<style>
:root {
    --primary-color: #0f9b0f;
    --bg-light: #f4f6f9;
    --card-radius: 16px;
}

body {
    background-color: var(--bg-light);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow-x: hidden;
}

/* ================= DARK MODE ================= */
body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
}
body.dark-mode .mobile-header,
body.dark-mode .stat-card,
body.dark-mode .item-card,
body.dark-mode .modal-content,
body.dark-mode #exchangeRateContainer {
    background-color: #1e1e1e !important;
    color: #e0e0e0;
}
body.dark-mode .form-control,
body.dark-mode .input-group-text {
    background-color: #2a2a2a;
    color: #fff;
    border-color: #444;
}
body.dark-mode .text-muted { color: #aaa !important; }

/* ================= UI ================= */
#loginSection {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #0f9b0f, #004d00);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
}

.mobile-header {
    background: white;
    padding: 10px 15px;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    position: sticky;
    top: 0;
    z-index: 1000;
    display: flex;
    gap: 6px;
    justify-content: space-between;
    align-items: center;
}

.btn-tool {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-main-add {
    background: var(--primary-color);
    color: white;
    padding: 8px 18px;
    border-radius: 30px;
    border: none;
}
.stat-card {
    background: white;
    border-radius: var(--card-radius);
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    cursor: pointer;
}
.item-card {
    background: white;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
}
.d-none-custom { display: none !important; }
</style>
</head>

<body>

<!-- ================= LOGIN ================= -->
<div id="loginSection">
    <div class="card p-4 rounded-4 text-center">
        <h4 class="fw-bold text-success">إدارة مخزون الصيدلية</h4>
        <input type="password" id="passInput" class="form-control mt-3" placeholder="الرمز السري">
        <button class="btn btn-success mt-3 w-100" onclick="attemptLogin()">دخول</button>
        <p id="loginError" class="text-danger small mt-2 d-none">رمز خاطئ</p>
    </div>
</div>

<!-- ================= DASHBOARD ================= -->
<div id="mainDashboard" class="d-none-custom">

<div class="mobile-header">
    <button class="btn-tool" onclick="toggleDarkMode()" title="الوضع الليلي">
        <i class="fas fa-moon"></i>
    </button>

    <button class="btn-tool" onclick="toggleLang()" title="اللغة">
        <i class="fas fa-language"></i>
    </button>

    <h6 class="fw-bold text-success m-0">إدارة المخزون</h6>

    <button class="btn-main-add" onclick="openAddModal()">
        <i class="fas fa-plus"></i>
    </button>
</div>

<div class="container p-3">
    <input id="searchInput" class="form-control mb-2" placeholder="بحث..." onkeyup="renderList()">
    <div id="inventoryContainer"></div>
</div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
const SYS_PASS = "123456";
let db = JSON.parse(localStorage.getItem('wm_db_v23')) || [];

function attemptLogin(){
    if(passInput.value === SYS_PASS){
        loginSection.classList.add('d-none-custom');
        mainDashboard.classList.remove('d-none-custom');
        renderList();
    } else {
        loginError.classList.remove('d-none');
    }
}

/* ===== Dark Mode ===== */
function toggleDarkMode(){
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('wm_dark','1');
}
if(localStorage.getItem('wm_dark')) document.body.classList.add('dark-mode');

/* ===== Language ===== */
function toggleLang(){
    const html = document.documentElement;
    const rtl = html.lang === 'ar';
    html.lang = rtl ? 'en':'ar';
    html.dir  = rtl ? 'ltr':'rtl';
    document.getElementById('bsLang').href =
        rtl
        ? 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css'
        : 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css';
}

/* ===== Inventory ===== */
function renderList(){
    inventoryContainer.innerHTML = '';
    db.filter(i => i.name.includes(searchInput.value))
      .forEach(i=>{
        inventoryContainer.innerHTML += `
        <div class="item-card">
            <b>${i.name}</b>
            <span>${i.qty}</span>
        </div>`;
    });
}

/* ===== PWA ===== */
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/service-worker.js');
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
